Controller={cursorSize:5,helpWindow:!1,showHelpWindowOnStart:!0,canShowNextWindow:!0,helpViews:[],currentHelpView:null,numberOfClockwise:0,numberOfCounterClockwise:0,initialize:function(){Controller.helpViews=["h1.html","h2.html","h3.html","h4.html"],$(document).keyup(function(e){Controller.handleKeypress(e)}),$(document).ready(function(){var e=$(window).height();$("#map-canvas").height(e),MapsController.initialize(),Controller.showHelpWindowOnStart&&Controller.addOrRemoveHelpWindow()}),$(window).resize(function(){var e=$(window).height();$("#map-canvas").height(e),Controller.computeCanvasSize()})},attachDetachCanvas:function(e){if(e){if(null==document.getElementById("cursor-canvas")){var o=document.createElement("canvas");o.height=$("#map-canvas").height(),o.width=$("#map-canvas").width(),o.setAttribute("id","cursor-canvas");var t=document.getElementById("wrapper");t.setAttribute("class","no-mouse");var n=document.getElementById("map-canvas");t.insertBefore(o,n)}}else if(document.getElementById("cursor-canvas")){document.getElementById("cursor-canvas").remove();var t=document.getElementById("wrapper");t.removeAttribute("class")}},computeCanvasSize:function(){if(document.getElementById("cursor-canvas")){var e=$("#map-canvas").height(),o=$("#map-canvas").width(),t=document.getElementsByTagName("canvas")[0];t.width=o,t.height=e}},drawCursor:function(e,o){if(!Controller.helpWindow){e>$("#map-canvas").width()-Controller.cursorSize&&(e=$("#map-canvas").width()-Controller.cursorSize),o>$("#map-canvas").height()-Controller.cursorSize&&(o=$("#map-canvas").height()-Controller.cursorSize);var t=document.getElementById("cursor-canvas");if(t){var n=t.getContext("2d");n.clearRect(0,0,n.canvas.width,n.canvas.height),n.beginPath(),n.rect(e,o,Controller.cursorSize,Controller.cursorSize),n.fill()}}},addOrRemoveHelpWindow:function(){if(Controller.helpWindow)Controller.helpWindow=!1,document.getElementById("help")&&document.getElementById("help").remove(),document.getElementById("modal-canvas")&&document.getElementById("modal-canvas").remove();else{Controller.helpWindow=!0;var e=document.createElement("div");if(e.setAttribute("id","help"),document.getElementById("wrapper").appendChild(e),Controller.loadHelpView(0),Controller.attachDetachCanvas(!1),null==document.getElementById("modal-canvas")){var o=document.createElement("canvas");o.height=$("#map-canvas").height(),o.width=$("#map-canvas").width(),o.setAttribute("id","modal-canvas");var t=document.getElementById("wrapper"),n=document.getElementById("map-canvas");t.insertBefore(o,n)}}},addOrRmoveLogWindow:function(){if(null==document.getElementById("log-window")){var e=document.createElement("div");e.setAttribute("id","log-window"),document.getElementById("wrapper").appendChild(e)}else document.getElementById("log-window").remove()},computePanningAcceleration:function(e,o){if(!Controller.helpWindow&&!MapsController.isInStreetView()){var t=.33*window.innerWidth,n=.66*window.innerWidth,r=.33*window.innerHeight,a=.66*window.innerHeight,l=0,i=0;e>n?l=Controller.mapValueToInterval(e,n,window.innerWidth,0,15):t>e&&(l=Controller.mapValueToInterval(e,0,t,-15,0)),o>a?i=Controller.mapValueToInterval(o,a,window.innerHeight,0,15):r>o&&(i=Controller.mapValueToInterval(o,0,r,-15,0)),MapsController.panBy(l,i)}},mapValueToInterval:function(e,o,t,n,r){return Math.round((r-n)/(t-o)*(e-o)+n)},handleKeypress:function(e){switch(e.keyCode){case 27:Controller.helpWindow?Controller.addOrRemoveHelpWindow():MapsController.isInStreetView()&&MapsController.switchMapMode(0,0);break;case 37:Controller.handleSwipe("fromLeftToRight");break;case 39:Controller.handleSwipe("fromRightToLeft");break;case 72:Controller.addOrRemoveHelpWindow();break;case 76:Controller.addOrRmoveLogWindow()}},handleCircle:function(e){Controller.helpWindow||(e?(Controller.numberOfClockwise++,35==Controller.numberOfClockwise&&(Controller.numberOfClockwise=0,MapsController.isInStreetView()?MapsController.moveStreetView(!0):MapsController.zoomMap(!0))):(Controller.numberOfCounterClockwise++,35==Controller.numberOfCounterClockwise&&(Controller.numberOfCounterClockwise=0,MapsController.isInStreetView()?MapsController.moveStreetView(!1):MapsController.zoomMap(!1))))},handleSwipe:function(e){if(Controller.helpWindow){if(Controller.canShowNextWindow){for(var o=null,t=0;t<Controller.helpViews.length;t++)if(Controller.currentHelpView==Controller.helpViews[t]){o="fromRightToLeft"==e?t+1:t-1;break}o>=0&&o<Controller.helpViews.length?Controller.loadHelpView(o):-1!=o&&Controller.addOrRemoveHelpWindow()}Controller.canShowNextWindow=!1,Controller.sleep(250,Controller.releaseLock)}else MapsController.isInStreetView()&&MapsController.rotate360(e)},handleKeyTap:function(e){Controller.helpWindow||MapsController.isInStreetView()||MapsController.addRemoveMarker(e.x,e.y)},handleScreenTap:function(e){Controller.helpWindow||MapsController.switchMapMode(e.x,e.y)},loadHelpView:function(e){$(function(){$("#help").load("views/help/"+Controller.helpViews[e]),Controller.currentHelpView=Controller.helpViews[e]})},releaseLock:function(){Controller.canShowNextWindow=!0},sleep:function(e,o){setTimeout(function(){o()},e)}},LeapMotionController={controller:Leap.loop({enableGestures:!0},function(e){if(!Controller.helpWindow){LeapMotionController.attachDetachCanvas(e);var o=LeapMotionController.computeHandPosition(e);o&&(Controller.drawCursor(o.x,o.y),5==LeapMotionController.getNumberOfFingers(e.hands[0])&&Controller.computePanningAcceleration(o.x,o.y))}LeapMotionController.detectAndHandleGestures(e),LeapMotionController.logData(e)}),logData:function(e){if(document.getElementById("log-window")){var o="";o="<b>Real time data: <br><hr>",o+="Google Maps: <br></b>";var t=MapsController.map,n=t.getCenter();if(o+=LeapMotionController.concatData("lat",n.lat()),o+=LeapMotionController.concatData("lng",n.lng()),MapsController.isInStreetView()){var r=t.getStreetView(),a=r.getPov();if(o+=LeapMotionController.concatData("Heading",a.heading),o+=LeapMotionController.concatData("Pitch",a.pitch),r.getLinks())for(var l=0;l<r.getLinks().length;l++)o+=LeapMotionController.concatData("Available heading "+l,r.getLinks()[l].heading)}else o+=LeapMotionController.concatData("Zoom",t.getZoom());o+="<hr><b>Leap Motion: <br></b>",o+=LeapMotionController.concatData("frame_id",e.id),o+=LeapMotionController.concatData("Number of hands",e.hands.length),o+=LeapMotionController.concatData("Number of fingers",LeapMotionController.getNumberOfFingers(e.hands[0])+LeapMotionController.getNumberOfFingers(e.hands[1]));for(var l=0;l<e.hands.length;l++){var i=e.hands[l];o+="<br>",o+=LeapMotionController.concatData("Hand type",i.type),o+=LeapMotionController.concatData("Hand confidence",i.confidence),o+=LeapMotionController.concatData("Hand position x",i.palmPosition[0]+" mm"),o+=LeapMotionController.concatData("Hand position y",i.palmPosition[1]+" mm"),o+=LeapMotionController.concatData("Hand position z",i.palmPosition[2]+" mm")}if(o+="<br>",o+="Gestures:<br>",e.gestures.length>0)for(var s=0;s<e.gestures.length;s++){var p=e.gestures[s];o+=LeapMotionController.concatData("Gesture name",p.type),o+=LeapMotionController.concatData("Gesture state",p.state),o+=LeapMotionController.concatData("Gesture duration",p.duration+" microseconds"),o+="<br>"}var c=document.getElementById("log-window");c.innerHTML=o}},concatData:function(e,o){return e+": "+o+"<br>"},attachDetachCanvas:function(e){Controller.attachDetachCanvas(LeapMotionController.isOneHand(e))},computeHandPosition:function(e){if(e.valid&&1==e.hands.length&&e.pointables.length>0){var o=e.pointables[0].stabilizedTipPosition,t=e.interactionBox.normalizePoint(o,!0),n=$("#map-canvas").width()*t[0],r=$("#map-canvas").height()*(1-t[1]),a={x:n,y:r};return a}return null},detectAndHandleGestures:function(e){e.valid&&e.gestures.length>0&&e.gestures.forEach(function(o){switch(o.type){case"circle":LeapMotionController.handleCircle(e,o);break;case"keyTap":break;case"screenTap":LeapMotionController.handleScreenTap(e);break;case"swipe":LeapMotionController.handleSwipe(o)}})},handleCircle:function(e,o){if(1==LeapMotionController.getNumberOfFingers(e.hands[0])){var t=!1,n=o.pointableIds[0],r=e.pointable(n).direction;if(r){var a=Leap.vec3.dot(r,o.normal);a>0&&(t=!0),Controller.handleCircle(t)}}},handleKeyTap:function(e){if(LeapMotionController.isOneHand(e)&&1==LeapMotionController.getNumberOfFingers(e.hands[0])){var o=LeapMotionController.computeHandPosition(e);o&&Controller.handleKeyTap(o)}},handleScreenTap:function(e){if(1==LeapMotionController.getNumberOfFingers(e.hands[0])){var o=LeapMotionController.computeHandPosition(e);o&&Controller.handleScreenTap(o)}},handleSwipe:function(e){if("stop"==e.state){var o=Math.abs(e.direction[0])>Math.abs(e.direction[1]);swipeDirection=o?e.direction[0]>0?"fromLeftToRight":"fromRightToLeft":e.direction[1]>0?"fromBottomToTop":"fromTopToBottom",Controller.handleSwipe(swipeDirection)}},isOneHand:function(e){return e.valid&&1==e.hands.length},getNumberOfFingers:function(e){var o=0;if(e)for(var t=0;t<e.fingers.length;t++){var n=e.fingers[t];n.extended&&o++}return o},getFingerName:function(e){switch(e){case 0:return"Thumb";case 1:return"Index";case 2:return"Middle";case 3:return"Ring";case 4:return"Pinky"}}},MapsController={map:null,lat:46.76907446541323,lng:23.59061690807345,pitchHeadingStep:7.5,streetViewRenderingRadius:150,streetViewAngleThreshold:40,zoom:10,zoomStep:1,panoramaZoomStep:.2,markers:[],initialize:function(){var e={center:new google.maps.LatLng(MapsController.lat,MapsController.lng),zoom:MapsController.zoom,maxZoom:18,minZoom:3,panControl:!1,zoomControl:!1,draggable:!0};MapsController.map=new google.maps.Map(document.getElementById("map-canvas"),e)},isInStreetView:function(){return MapsController.map.getStreetView().getVisible()},panBy:function(e,o){MapsController.isInStreetView()||(0!=e||0!=o)&&MapsController.map.panBy(e,o)},moveMap:function(e,o){MapsController.isInStreetView()||MapsController.map.panTo(new google.maps.LatLng(e,o))},rotate360:function(e){if(MapsController.isInStreetView()){var o=MapsController.map.getStreetView().getPov().pitch,t=MapsController.map.getStreetView().getPov().heading;switch(e){case"fromBottomToTop":o<90-MapsController.pitchHeadingStep&&(o+=MapsController.pitchHeadingStep);break;case"fromTopToBottom":o>-90+MapsController.pitchHeadingStep&&(o-=MapsController.pitchHeadingStep);break;case"fromLeftToRight":t+=MapsController.pitchHeadingStep;break;case"fromRightToLeft":t-=MapsController.pitchHeadingStep}t%=360,MapsController.map.getStreetView().setPov({heading:t,pitch:o})}},zoomMap:function(e){if(MapsController.isInStreetView()){var o=MapsController.map.getStreetView().getZoom();direction?o+=MapsController.panoramaZoomStep:o-=MapsController.panoramaZoomStep,MapsController.map.getStreetView().setZoom(o)}else{var t=MapsController.map.getZoom();e?t+=MapsController.zoomStep:t-=MapsController.zoomStep,MapsController.map.setZoom(t)}},moveStreetView:function(e){if(MapsController.isInStreetView()){var o=MapsController.map.getStreetView().getPov().heading;o%=360,0>o&&(o+=360),e||(o-=180,0>o&&(o+=360));for(var t=0;t<MapsController.map.getStreetView().getLinks().length;t++){var n=MapsController.map.getStreetView().getLinks()[t].heading;o>n-MapsController.streetViewAngleThreshold&&o<n+MapsController.streetViewAngleThreshold&&(MapsController.map.getStreetView().setPano(MapsController.map.getStreetView().getLinks()[t].pano),e||(n-=180,0>n&&(n+=360)),MapsController.map.getStreetView().setPov({heading:n,pitch:MapsController.map.getStreetView().getPov().pitch}))}}},addRemoveMarker:function(e,o){var t=new google.maps.Marker({position:MapsController.fromPixelToLatLng(e,o),map:MapsController.map});MapsController.markers.push(t)},switchMapMode:function(e,o){if(MapsController.isInStreetView())MapsController.map.getStreetView().setVisible(!1);else{var t=MapsController.fromPixelToLatLng(e,o),n=new google.maps.StreetViewService;n.getPanoramaByLocation(t,MapsController.streetViewRenderingRadius,function(e,o){if("OK"==o){var n={pano:e.location.pano};MapsController.map.setStreetView(new google.maps.StreetViewPanorama(document.getElementById("map-canvas"),n)),MapsController.map.getStreetView().setZoom(0)}else alert("There is no street view panorama available for a radius of "+MapsController.streetViewRenderingRadius+" meters at this coordinates: lat: "+t.lat()+", lng: "+t.lng()+"\n\nPlease try again")})}},fromPointToLatLng:function(e,o){var t=Math.pow(2,o),n=new google.maps.Point(e.x/t,e.y/t);return latLng=MapsController.map.getProjection().fromPointToLatLng(n)},fromPixelToLatLng:function(e,o){var t=MapsController.map.getBounds(),n=t.getNorthEast(),r=t.getSouthWest(),a=MapsController.map.getProjection().fromLatLngToPoint(n),l=MapsController.map.getProjection().fromLatLngToPoint(r),i=e/$("#map-canvas").width(),s=o/$("#map-canvas").height(),p=(a.x-l.x)*i+l.x,c=(l.y-a.y)*s+a.y;return newLatLng=MapsController.map.getProjection().fromPointToLatLng(new google.maps.Point(p,c))}};